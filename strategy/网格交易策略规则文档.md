# 网格交易策略规则文档

## 策略概述

网格交易策略是一种基于价格区间的自动化交易策略，通过在预设的价格网格内进行高频买卖操作，利用价格波动获得套利收益。

## 核心参数设置

### 基础参数
- **网格间距 (grid_size)**: 0.5% - 10% (测试范围: 0.005, 0.01, 0.015, 0.02, 0.03, 0.05, 0.07, 0.1)
- **半网格数量 (grid_numbers_half)**: 2 - 10 (测试范围: 2, 3, 5, 7, 10)
- **每个网格投入资金**: 100 USDT
- **手续费率**: 0.08% (0.0008)
- **初始资金**: 1000 USDT (推荐)

### 资金需求计算
| 半网格数 | 总网格数 | 初始资金需求 |
|---------|---------|-------------|
| 2       | 4       | 400 USDT    |
| 3       | 6       | 600 USDT    |
| 5       | 10      | 1000 USDT   |
| 7       | 14      | 1400 USDT   |
| 10      | 20      | 2000 USDT   |

## 交易规则详解

### 1. 网格初始化规则

#### 网格价格计算
```python
def calculate_grid_levels(start_price, grid_size, grid_numbers_half):
    levels = [start_price / (1 + grid_size)**i for i in range(grid_numbers_half, 0, -1)]
    levels.append(start_price)
    levels += [start_price * (1 + grid_size)**i for i in range(1, grid_numbers_half + 1)]
    return levels
```

**规则说明**:
- 以当前价格为中心点
- 向下创建 `grid_numbers_half` 个网格
- 向上创建 `grid_numbers_half` 个网格
- 总网格数 = 2 × `grid_numbers_half` + 1

#### 示例
- 中心价格: 50000 USDT
- 网格间距: 1% (0.01)
- 半网格数: 5
- 网格价格: [47573, 48053, 48535, 49020, 49505, **50000**, 50500, 51005, 51515, 52030, 52550]

### 2. 网格内交易规则

#### 买入触发条件
- **触发条件**: 价格下跌到下一个网格线
- **买入数量**: 100 USDT / 总网格数
- **买入价格**: 网格线价格
- **执行逻辑**: 当 `current_price <= grid_levels[current_level - 1]` 时触发

#### 卖出触发条件
- **触发条件**: 价格上涨到下一个网格线
- **卖出数量**: 100 USDT / 总网格数
- **卖出价格**: 网格线价格
- **执行逻辑**: 当 `current_price >= grid_levels[current_level + 1]` 时触发

### 3. 网格突破重置规则

#### 向上突破重置
**触发条件**: 价格超过网格上限 (`current_price > upper_bound`)

**处理流程**:
1. **计算收益**:
   - 上涨收益 = `(grid_numbers_half * (grid_numbers_half + 1) / 2) * 100 / grid_numbers * (grid_size - fee_pct * 2)`
   - 套利收益 = `(trade_count - grid_numbers_half) / 2 * 100 / grid_numbers * (grid_size - fee_pct * 2)`

2. **收益存储**: 将收益存入钱包 (`wallet`)

3. **网格重置**: 以当前价格为中心重新建立网格

4. **资金追加**: 自动增加100 USDT投入资金

#### 向下突破重置
**触发条件**: 价格跌破网格下限 (`current_price < lower_bound`)

**处理流程**:
1. **计算已实现收益**:
   - 计算已触发的上涨网格数量
   - 上涨收益 = `(count * (count + 1)) * 100 / grid_numbers * (grid_size - fee_pct * 2)`
   - 套利收益 = `(trade_count - grid_numbers_half - count) / 2 * 100 / grid_numbers * (grid_size - fee_pct * 2)`

2. **BTC转换**: 将部分资金转换为BTC持有
   - 基础BTC = `50 / initial_price * (1 - fee_pct * 2)`
   - 网格BTC = `Σ(100 / grid_numbers / grid_levels[i] * (1 - fee_pct * 2))`

3. **资金管理**:
   - 如果钱包余额 >= 100 USDT: 使用钱包资金
   - 如果钱包余额 < 100 USDT: 需要额外投入资金

4. **网格重置**: 以当前价格为中心重新建立网格

### 4. 资金管理规则

#### 盈利钱包机制
- **存储**: 每次网格重置时将收益存入钱包
- **用途**: 优先用于向下突破时的补仓
- **优势**: 减少额外资金需求，提高资金效率

#### 资金追加规则
```python
if wallet >= 100:
    wallet -= 100  # 使用盈利补仓
elif wallet < 100:
    money_input += 100 - wallet  # 需要额外投入
    wallet = 0
```

### 5. 收益计算规则

#### 上涨收益
- **计算公式**: `(grid_numbers_half * (grid_numbers_half + 1) / 2) * 100 / grid_numbers * (grid_size - fee_pct * 2)`
- **说明**: 基于网格层级的等差数列求和

#### 套利收益
- **计算公式**: `(trade_count - grid_numbers_half) / 2 * 100 / grid_numbers * (grid_size - fee_pct * 2)`
- **说明**: 基于实际交易次数与理论次数的差值

#### 手续费扣除
- **买入手续费**: 买入金额 × 0.08%
- **卖出手续费**: 卖出金额 × 0.08%
- **净收益**: 毛收益 - 双向手续费

### 6. 风险控制规则

#### 资金风险控制
- **最大投入**: 建议不超过总资产的30%
- **缓冲资金**: 准备比初始资金多50%的缓冲资金
- **分批投入**: 先小资金测试，验证效果后增加投入

#### 网格风险控制
- **网格间距**: 根据市场波动性调整
- **网格数量**: 根据资金规模调整
- **止损机制**: 通过向下突破重置实现动态止损

## 策略优势

### 1. 自动化执行
- 无需人工干预
- 24小时连续运行
- 情绪化交易风险低

### 2. 风险分散
- 通过网格分散投资风险
- 避免单点买入风险
- 动态调整持仓结构

### 3. 双向获利
- 上涨和下跌都能获得收益
- 利用价格波动进行套利
- 市场中性策略

### 4. 资金效率
- 盈利自动循环利用
- 减少外部资金依赖
- 提高资金使用效率

## 适用场景

### 1. 震荡市场
- 价格在一定区间内波动
- 无明显趋势方向
- 适合网格交易

### 2. 高波动性资产
- 加密货币
- 商品期货
- 外汇交易

### 3. 长期投资
- 适合长期持有
- 通过网格获得额外收益
- 降低持仓成本

## 注意事项

### 1. 市场风险
- 单边趋势市场可能亏损
- 需要及时调整网格参数
- 关注市场环境变化

### 2. 技术风险
- 系统故障风险
- 网络延迟风险
- 数据质量问题

### 3. 资金风险
- 需要足够的初始资金
- 可能面临追加资金需求
- 流动性风险

## 参数优化建议

### 1. 网格间距优化
- **低波动市场**: 0.5% - 1%
- **中波动市场**: 1% - 3%
- **高波动市场**: 3% - 10%

### 2. 网格数量优化
- **小资金**: 2-5个半网格
- **中资金**: 5-10个半网格
- **大资金**: 10-20个半网格

### 3. 资金配置优化
- **保守配置**: 1000 USDT, 5个半网格, 1-2%间距
- **激进配置**: 2000 USDT, 10个半网格, 0.5-1%间距

---

*本文档详细描述了网格交易策略的所有交易规则和参数设置，可作为策略实施和优化的参考依据。* 